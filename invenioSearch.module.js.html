<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>invenioSearch.module.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="invenioSearch.html">invenioSearch</a><ul class='methods'><li data-type='method'><a href="invenioSearch.html#.link">link</a></li></ul></li><li><a href="invenioSearchAPI.html">invenioSearchAPI</a><ul class='methods'><li data-type='method'><a href="invenioSearchAPI.html#.error">error</a></li><li data-type='method'><a href="invenioSearchAPI.html#.search">search</a></li><li data-type='method'><a href="invenioSearchAPI.html#.success">success</a></li></ul></li><li><a href="invenioSearchBar.html">invenioSearchBar</a><ul class='methods'><li data-type='method'><a href="invenioSearchBar.html#.link">link</a></li><li data-type='method'><a href="invenioSearchBar.html#.templateUrl">templateUrl</a></li><li data-type='method'><a href="invenioSearchBar.html#.updateQuery">updateQuery</a></li></ul></li><li><a href="invenioSearchConfiguration.html">invenioSearchConfiguration</a></li><li><a href="invenioSearchController.html">invenioSearchController</a><ul class='methods'><li data-type='method'><a href="invenioSearchController.html#.invenioDoSearch">invenioDoSearch</a></li><li data-type='method'><a href="invenioSearchController.html#.invenioSearchErrorHandler">invenioSearchErrorHandler</a></li><li data-type='method'><a href="invenioSearchController.html#.invenioSearchGetUrlArgs">invenioSearchGetUrlArgs</a></li><li data-type='method'><a href="invenioSearchController.html#.invenioSearchLocationChange">invenioSearchLocationChange</a></li><li data-type='method'><a href="invenioSearchController.html#.invenioSearchSetUrlArgs">invenioSearchSetUrlArgs</a></li></ul></li><li><a href="invenioSearchCount.html">invenioSearchCount</a><ul class='methods'><li data-type='method'><a href="invenioSearchCount.html#.templateUrl">templateUrl</a></li></ul></li><li><a href="invenioSearchError.html">invenioSearchError</a><ul class='methods'><li data-type='method'><a href="invenioSearchError.html#.link">link</a></li><li data-type='method'><a href="invenioSearchError.html#.templateUrl">templateUrl</a></li></ul></li><li><a href="invenioSearchFacets.html">invenioSearchFacets</a><ul class='methods'><li data-type='method'><a href="invenioSearchFacets.html#.templateUrl">templateUrl</a></li></ul></li><li><a href="invenioSearchFacetsClick.html">invenioSearchFacetsClick</a><ul class='methods'><li data-type='method'><a href="invenioSearchFacetsClick.html#.link">link</a></li></ul></li><li><a href="invenioSearchHandler.html">invenioSearchHandler</a><ul class='methods'><li data-type='method'><a href="invenioSearchHandler.html#.get">get</a></li><li data-type='method'><a href="invenioSearchHandler.html#.set">set</a></li></ul></li><li><a href="invenioSearchLoading.html">invenioSearchLoading</a><ul class='methods'><li data-type='method'><a href="invenioSearchLoading.html#.link">link</a></li><li data-type='method'><a href="invenioSearchLoading.html#.templateUrl">templateUrl</a></li></ul></li><li><a href="invenioSearchPagination.html">invenioSearchPagination</a><ul class='methods'><li data-type='method'><a href="invenioSearchPagination.html#.link">link</a></li><li data-type='method'><a href="invenioSearchPagination.html#.templateUrl">templateUrl</a></li></ul></li><li><a href="invenioSearchResults.html">invenioSearchResults</a><ul class='methods'><li data-type='method'><a href="invenioSearchResults.html#.link">link</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">invenioSearch.module.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * This file is part of Invenio.
 * Copyright (C) 2015, 2016 CERN.
 *
 * Invenio is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License as
 * published by the Free Software Foundation; either version 2 of the
 * License, or (at your option) any later version.
 *
 * Invenio is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Invenio; if not, write to the Free Software Foundation, Inc.,
 * 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA.
 *
 * In applying this license, CERN does not
 * waive the privileges and immunities granted to it by virtue of its status
 * as an Intergovernmental Organization or submit itself to any jurisdiction.
 */

(function (angular) {
  // Controllers

  /**
   * @ngdoc controller
   * @name invenioSearchController
   * @namespace invenioSearchController
   * @description
   *    Invenio search controller.
   */
  function invenioSearchController($scope, invenioSearchHandler, invenioSearchAPI) {

    // Assign controller to `vm`
    var vm = this;

    // Parameters

    // Initialize search resutls
    vm.invenioSearchResults = {};

    // Search Loading - if invenioSearch has the state loading
    vm.invenioSearchLoading = true;

    // Search Error - if invenioSearch has the state error
    vm.invenioSearchError = {};

    // Search Query Args - invenioSearch query arguments
    vm.invenioSearchArgs = {
      method: 'GET',
      params: {
        page: 1,
        size: 20,
      }
    };

    // Search URL arguments
    // Get
    vm.invenioSearchGetUrlArgs = invenioSearchGetUrlArgs;
    // Set
    vm.invenioSearchSetUrlArgs = invenioSearchSetUrlArgs;

    // Invenio Do Search
    vm.invenioDoSearch = invenioDoSearch;

    ////////////

    // Functions

    /**
     * Get url parameters.
     * @memberof invenioSearchController
     * @function invenioSearchGetUrlArgs
     * @returnis {Object} The url parameters.
     */
    function invenioSearchGetUrlArgs() {
      return invenioSearchHandler.get();
    }

    /**
     * Set url parameters.
     * @memberof invenioSearchController
     * @function invenioSearchSetUrlArgs
     * @param {Object} newParameters - The new search parameters.
     * @param {Object} currentParameters - The current search response.
     */
    function invenioSearchSetUrlArgs(newParameters, currentParameters) {
      // If the page haven't changed make sure that we are back to page 1
      if (newParameters !== undefined) {
        if (newParameters.page === currentParameters.page) {
          vm.invenioSearchArgs.params.page = 1;
        }
      }

      // Broadcast url changed
      $scope.$broadcast('invenio.search.url.changed');

      // Update the userQuery with the latest
      vm.userQuery = vm.invenioSearchArgs.params.q;
      // Set the new url
      invenioSearchHandler.set(vm.invenioSearchArgs.params);
    }

    /**
     * Do the search
     * @memberof invenioSearchController
     * @function invenioDoSearch
     */
    function invenioDoSearch() {
      // Broadcast search requested
      $scope.$broadcast('invenio.search.requested');

      // Set state to loading
      vm.invenioSearchLoading = true;
      // Clear any previous errors
      vm.invenioSearchError = {};

      /**
       * After the request finish proccesses
       * @memberof invenioDoSearch
       * @function clearRequest
       */
      function clearRequest() {
        vm.invenioSearchLoading = false;
        // Broadcast the search finished
        $scope.$broadcast('invenio.search.finished');
      }

      /**
       * After a successful request
       * @memberof invenioDoSearch
       * @function successfulRequest
       * @param {Object} response - The search request response.
       */
      function successfulRequest(response) {
        // Broadcast the success
        $scope.$broadcast('invenio.search.success');
        // Assign the new data
        vm.invenioSearchResults = response.data;
      }

      /**
       * After an errored request
       * @memberof invenioDoSearch
       * @function erroredRequest
       * @param {Object} error - The search request response.
       */
      function erroredRequest(error) {
        // Set results to none
        vm.invenioSearchResults = {};
        // Broadcast the error
        $scope.$broadcast('invenio.search.error', error);
      }

      invenioSearchAPI
        .search(vm.invenioSearchArgs)
        .then(successfulRequest, erroredRequest)
        .finally(clearRequest);
    }

    /**
     * Merge `invenioSearchArgs` with updated parameters
     * @memberof invenioSearchController
     * @function invenioSearchLocationChange
     * @param {Object} $event - The event object.
     * @param {Object} nextUrl - The new url value.
     * @param {Object} currentUrl - The current url value.
     */
    function invenioSearchLocationChange($event, nextUrl, currentUrl) {
      if (!angular.equals(nextUrl, currentUrl)) {
        // Get the parameters
        var parameters = {
          params: vm.invenioSearchGetUrlArgs()
        };

        // Merge the parameters with the current `invenioSearchArgs`
        vm.invenioSearchArgs = angular.merge(
          vm.invenioSearchArgs,
          parameters
        );
      }
      // Do the action search
      vm.invenioDoSearch();
    }


    /**
     * Proccess a search error
     * @memberof invenioSearchController
     * @function invenioSearchErrorHandler
     * @param {Object} error - The error trace.
     */
    function invenioSearchErrorHandler(error) {
      // Set the new error
      vm.invenioSearchError = error;
    }

    ////////////

    // Listeners

    // When URL parameters changed
    $scope.$on('$locationChangeStart', invenioSearchLocationChange);
    // When the search errored
    $scope.$on('invenio.search.error', invenioSearchErrorHandler);
    // When invenioSearchArgs.params has changed
    $scope.$watchCollection(
      'vm.invenioSearchArgs.params', vm.invenioSearchSetUrlArgs
    );

    ////////////

  }

  invenioSearchController.$inject = [
    '$scope', 'invenioSearchHandler', 'invenioSearchAPI'
  ];

  ////////////

  // Directives

  /**
   * @ngdoc directive
   * @name invenioSearch
   * @description
   *    The invenioSearch directive handler
   * @namespace invenioSearch
   * @example
   *    Usage:
   *    &lt;invenio-search
   *     search-endpoint='SEARCH_PROVIDER_URL'
   *     search-extra-params='{"page": 2, "size": 5}'>
   *        ... Any children directives
   *    &lt;/invenio-search>
   */
  function invenioSearch() {

    // Functions

    /**
     * Initialize search
     * @memberof invenioSearch
     * @param {service} scope -  The scope of this element.
     * @param {service} element - Element that this direcive is assigned to.
     * @param {service} attrs - Attribute of this element.
     * @param {invenioSearchController} vm - Invenio search controller.
     */
    function link(scope, element, attrs, vm) {
      // Update search parameters
      var collectedArgs = {
        url: attrs.searchEndpoint,
        method: attrs.searchMethod || 'GET',
      };

      // Add any extra parameters
      var extraParams = {
        params: JSON.parse(attrs.searchExtraParams || '{}')
      };

      var urlParams = {
        params: vm.invenioSearchGetUrlArgs()
      };

      // Update arguments
      vm.invenioSearchArgs = angular.merge(
        vm.invenioSearchArgs,
        collectedArgs,
        extraParams,
        urlParams
      );
    }

    ////////////

    return {
      restrict: 'AE',
      scope: false,
      controller: 'invenioSearchController',
      controllerAs: 'vm',
      link: link,
    };
  }

  /**
   * @ngdoc directive
   * @name invenioSearchBar
   * @description
   *    The invenioSearchBar directive
   * @namespace invenioSearchBar
   * @example
   *    Usage:
   *    &lt;invenio-search-bar
   *     placeholder='Start typing'
   *     template='TEMPLATE_PATH'>
   *        ... Any children directives
   *    &lt;/invenio-search-bar>
   */
  function invenioSearchBar() {

    // Functions

    /**
     * Force apply the attributes to the scope
     * @memberof invenioSearchBar
     * @param {service} scope -  The scope of this element.
     * @param {service} element - Element that this direcive is assigned to.
     * @param {service} attrs - Attribute of this element.
     * @param {invenioSearchController} vm - Invenio search controller.
     */
    function link(scope, element, attrs, vm) {

      /**
      * Assign the user's query to invenioSearchArgs.params.q
      * @memberof invenioSearchBar
      */
      function updateQuery() {
        vm.invenioSearchArgs.params.q = vm.userQuery;
      }

      scope.placeholder = attrs.placeholder;
      scope.updateQuery = updateQuery;
    }

    /**
     * Choose template for search bar
     * @memberof invenioSearchBar
     * @param {service} element - Element that this direcive is assigned to.
     * @param {service} attrs - Attribute of this element.
     * @example
     *    Minimal template `template.html` usage
     *        &lt;input
     *          ng-model='vm.invenioSearchArgs.params.q'
     *          placeholder='{{ placeholder }}'
     *         />
     */
    function templateUrl(element, attrs) {
      return attrs.template;
    }

    ////////////

    return {
      restrict: 'AE',
      require: '^invenioSearch',
      scope: false,
      templateUrl: templateUrl,
      link: link,
    };
  }

  /**
   * @ngdoc directive
   * @name invenioSearchLoading
   * @description
   *    The invenioSearchLoading directive
   * @namespace invenioSearchLoading
   * @example
   *    Usage:
   *    &lt;invenio-search-loading
   *     message='{{ _('Loading') }}'
   *     template='TEMPLATE_PATH'>
   *        ... Any children directives
   *    &lt;/invenio-search-loading>
   */
  function invenioSearchLoading() {

    // Functions

    /**
     * Force apply the attributes to the scope
     * @memberof invenioSearchLoading
     * @param {service} scope -  The scope of this element.
     * @param {service} element - Element that this direcive is assigned to.
     * @param {service} attrs - Attribute of this element.
     * @param {invenioSearchController} vm - Invenio search controller.
     */
    function link(scope, element, attrs, vm) {
      scope.loadingMessage = attrs.message;
    }

    /**
     * Choose template for search loading
     * @memberof invenioSearchLoading
     * @param {service} element - Element that this direcive is assigned to.
     * @param {service} attrs - Attribute of this element.
     * @example
     *    Minimal template `template.html` usage
     *        &lt;div ng-show='vm.invenioSearchLoading'>
     *          &lt;i class='fa fa-loading'>&lt;/i> {{ loadingMessage }}
     *        &lt;/div>
     */
    function templateUrl(element, attrs) {
      return attrs.template;
    }

    ////////////

    return {
      restrict: 'AE',
      require: '^invenioSearch',
      templateUrl: templateUrl,
      link: link,
    };
  }

  /**
   * @ngdoc directive
   * @name invenioSearchResults
   * @description
   *    The invenioSearchResults directive
   * @namespace invenioSearchResults
   * @example
   *    Usage:
   *    &lt;invenio-search-results
   *     template='TEMPLATE_PATH'
   *     records-template='TEMPLATE_PATH'>
   *        ... Any children directives
   *    &lt;/invenio-search-results>
   */
  function invenioSearchResults() {

    // Functions

    /**
     * Force apply the attributes to the scope
     * @memberof invenioSearchResults
     * @param {service} scope -  The scope of this element.
     * @param {service} element - Element that this direcive is assigned to.
     * @param {service} attrs - Attribute of this element.
     * @param {invenioSearchController} vm - Invenio search controller.
     */
    function link(scope, element, attrs, vm) {
      scope.recordTemplate = attrs.recordTemplate;
    }

    /**
     * Choose template for search loading
     * @memberof invenioSearchREsults
     * @param {service} element - Element that this direcive is assigned to.
     * @param {service} attrs - Attribute of this element.
     * @example
     *    Minimal template `template.html` usage
     *    &lt;div ng-repeat="record in invenioSearchResults track by $index">
     *      &lt;div ng-include="recordsTemplate">&lt;/div>
     *    &lt;/div>
     *
     *    Minimal `recordsTemplate`
     *    &lt;h2>{{ record.title }}&lt;/h2>
     */
    function templateUrl(element, attrs) {
      return attrs.template;
    }

    ////////////

    return {
      restrict: 'AE',
      scope: false,
      require: '^invenioSearch',
      templateUrl: templateUrl,
      link: link,
    };
  }

  /**
   * @ngdoc directive
   * @name invenioSearchError
   * @description
   *    The invenio search results errors
   * @namespace invenioSearchError
   * @example
   *    Usage:
   *    &lt;invenio-search-error
   *     template='TEMPLATE_PATH'>
   *        ... Any children directives
   *    &lt;/invenio-search-error>
   */
  function invenioSearchError() {

    // Functions

    /**
     * Force apply the attributes to the scope
     * @memberof invenioSearchError
     * @param {service} scope -  The scope of this element.
     * @param {service} element - Element that this direcive is assigned to.
     * @param {service} attrs - Attribute of this element.
     * @param {invenioSearchController} vm - Invenio search controller.
     */
    function link(scope, element, attrs, vm) {
      scope.errorMessage = attrs.message;
    }

    /**
     * Choose template for search error
     * @memberof invenioSearchError
     * @param {service} element - Element that this direcive is assigned to.
     * @param {service} attrs - Attribute of this element.
     * @example
     *    Minimal template `template.html` usage
     *        &lt;div ng-show='vm.invenioSearchError'>
     *            {{ errorMessage }}
     *        &lt;/div>
     */
    function templateUrl(element, attrs) {
      return attrs.template;
    }

    ////////////

    return {
      restrict: 'AE',
      scope: false,
      require: '^invenioSearch',
      templateUrl: templateUrl,
      link: link,
    };
  }

  /**
   * @ngdoc directive
   * @name invenioSearchCount
   * @description
   *    The invenio search results count
   * @namespace invenioSearchCount
   * @example
   *    Usage:
   *    &lt;invenio-search-count
   *     template='TEMPLATE_PATH'>
   *        ... Any children directives
   *    &lt;/invenio-search-count>
   */
  function invenioSearchCount() {

    // Functions

    /**
     * Choose template for search count
     * @memberof invenioSearchCount
     * @param {service} element - Element that this direcive is assigned to.
     * @param {service} attrs - Attribute of this element.
     * @example
     *    Minimal template `template.html` usage
     *        &lt;div ng-show='vm.invenioSearchResults.length > 0'>
     *          {{ vm.invenioSearchResults.length }} records.
     *        &lt;/div>
     */
    function templateUrl(element, attrs) {
      return attrs.template;
    }

    ////////////

    return {
      restrict: 'AE',
      scope: false,
      require: '^invenioSearch',
      templateUrl: templateUrl,
    };
  }

  /**
   * @ngdoc directive
   * @name invenioSearchFacets
   * @description
   *    The invenio search results facets
   * @namespace invenioSearchFacets
   * @example
   *    Usage:
   *    &lt;invenio-search-facets
   *     template='TEMPLATE_PATH'>
   *        ... Any children directives
   *    &lt;/invenio-search-facets>
   */
  function invenioSearchFacets() {

    // Functions

    /**
     * Choose template for facets
     * @memberof invenioSearchFacets
     * @param {service} element - Element that this direcive is assigned to.
     * @param {service} attrs - Attribute of this element.
     * @example
     *    Minimal template `template.html` usage
     *        &lt;div ng-repeat='facet in vm.invenioSearchResults.facets'>
     *            &lt;invenio-search-facets-click
     *             key="{{ facet.key }}
     *             value="{{ facet.value }}">
     *             &lt;/invenio-search-facets-click>
     *        &lt;/div>
     */
    function templateUrl(element, attrs) {
      return attrs.template;
    }

    ////////////

    return {
      restrict: 'AE',
      scope: false,
      require: '^invenioSearch',
      templateUrl: templateUrl,
    };
  }

  /**
   * @ngdoc directive
   * @name invenioSearchFacetsClick
   * @param {service} $timeout - Angular window.timeout service.
   * @description
   *    The invenio search results facets select handler
   * @namespace invenioSearchFacetsClick
   * @example
   *    Usage:
   *    &lt;invenio-search-facets-click
   *     key="FACET_NAME"
   *     value="FACET_ITEM_VALUE">
   *        ... Any children directives
   *    &lt;/invenio-search-facets-click>
   */
  function invenioSearchFacetsClick($timeout) {

    // Functions

    /**
     * Handle the click on any facet
     * @memberof invenioSearchFacetsClick
     * @param {service} scope -  The scope of this element.
     * @param {service} element - Element that this direcive is assigned to.
     * @param {service} attrs - Attribute of this element.
     * @param {invenioSearchController} vm - Invenio search controller.
     */
    function link(scope, element, attrs, vm) {
      var key = scope.$parent.$parent.key;
      var value = scope.item.key.trim();

      // Check if the box should be checked
      if (vm.invenioSearchArgs.params[key] === value) {
        element[0].checked = true;
      }

      /**
       * Handle click on the element
       * @memberof link
       */
      function handleClick() {
        var params = {};
        params[key]= (element[0].checked) ? value : null;
        $timeout(function() {
          vm.invenioSearchArgs.params = angular.merge(
            vm.invenioSearchArgs.params, params
          );
        }, 0);
      }
      // on element click update invenioSearchArgs.params
      element.bind('click', handleClick);
    }

    ////////////

    return {
      restrict: 'AE',
      scope: false,
      require: '^invenioSearch',
      link: link,
    };
  }

  // Inject the necessary angular services
  invenioSearchFacetsClick.$inject = ['$timeout'];


  /**
   * @ngdoc directive
   * @name invenioSearchPagination
   * @description
   *   The pagination directive for search
   * @namespace invenioSearchPagination
   * @example
   *    Usage:
   *    &lt;invenio-search-pagination
   *     template='TEMPLATE_PATH'>
   *        ... Any children directives
   *    &lt;/invenio-search-pagination>
   */
  function invenioSearchPagination() {
    // Functions

    /**
     * Handle pagination
     * @memberof invenioSearchPagination
     * @param {service} scope -  The scope of this element.
     * @param {service} element - Element that this direcive is assigned to.
     * @param {service} attrs - Attribute of this element.
     * @param {invenioSearchController} vm - Invenio search controller.
     */
    function link(scope, element, attrs, vm) {
       // Watch when `invenioSearchArgs` changes and fire a new search
      scope.paginatePages = [];

      scope.$watch('vm.invenioSearchArgs.params.page', function(current, next) {
        if (current !== next) {
          buildPages();
        }
      });

      scope.$watch('vm.invenioSearchResults', function(current, next) {
        buildPages();
      });

      /**
       * Add range number for magination
       * @memberof link
       * @param {int} start - The start of the range.
       * @param {int} finish - The end of the range.
       */
      function addRange(start, finish) {
        // Create the Add Item Function
        var _current = current();

        var buildItem = function (i) {
          return {
            value: i,
            title: 'Go to page ' + i,
          };
        };

        // Add our items where i is the page number
        for (var i = start; i &lt;= finish; i++) {
          var item = buildItem(i);
          scope.paginatePages.push(item);
        }
      }

      /**
       * Add the last or end items in our paging list
       * @memberof link
       * @param {int} pageCount - The last page number or total page count.
       * @param {int} prev - The previous page number in the paging.
       */
      function addLast(pageCount, prev) {
        if (prev !== pageCount - 2) {
          addDots();
        }
        addRange(pageCount - 1, pageCount);
      }

      /**
       * Add dots
       * @memberof link
       */
      function addDots() {
        scope.paginatePages.push({
          value: '..'
        });
      }

      /**
       * Add the first or beginning items in our paging list
       * @memberof link
       * @param {int} next - The next page number in sequence.
       */
      function addFirst(next) {
        addRange(1, 2);
        if (next !== 3) {
          addDots();
        }
      }

      /**
       * Calculate the numbers
       * @memberof link
       */
      function buildPages() {
        // Reset pages
        scope.paginatePages = [];
        // How many neighbours to show before and after the current page
        var adjacent = 2;
        // Get total pages based on the results shown by page
        var pageCount = total();
        // Get the current page
        var _current = current();
        // Display the adjacent a1 a2 a3 + current + a5 a6 a7
        var adjacentSize = (2 * adjacent) + 2;

        // Pages to show in the pagination
        var start, finish;
        // Simply display all the pages
        if (pageCount &lt;= (adjacentSize + 2)) {
          start = 1;
          addRange(start, pageCount);
        } else {
          if (_current - adjacent &lt;= 2) {
            start = 1;
            finish = 1 + adjacentSize;
            addRange(start, finish);
            addLast(pageCount, finish);
          } else if (_current &lt; pageCount - (adjacent + 2)) {
            start = _current - adjacent;
            finish = _current + adjacent;
            addFirst(start);
            addRange(start, finish);
            addLast(pageCount, finish);
          } else {
            start = pageCount - adjacentSize;
            finish = pageCount;
            addFirst(start);
            addRange(start, finish);
          }
        }
      }

      /**
       * Calculate the total pages
       * @memberof link
       */
      function total() {
        var _total;
        try {
          _total = vm.invenioSearchResults.hits.total;
        } catch (error) {
          _total = 0;
        }
        return Math.ceil(_total/vm.invenioSearchArgs.params.size);
      }

      /**
       * Calculate the current page
       * @memberof link
       */
      function current() {
        return parseInt(vm.invenioSearchArgs.params.page) || 1;
      }

      /**
       * Calculate the next page
       * @memberof link
       */
      function next() {
        var _next = current();
        var _total = total();
        if (_next &lt; _total) {
          _next = _next + 1;
        }
        return _next;
      }

      /**
       * Calculate the previous page
       * @memberof link
       */
      function previous() {
        var _previous = current();
        var _total = total();
        if (_previous > 1) {
          _previous = _previous - 1;
        }
        return _previous;
      }

      /**
       * Calculate page class if it is active or not
       * @memberof link
       * @param {int} index - A given page of the array.
       */
      function getPageClass(index) {
        return index === current() ? 'active' : '';
      }

      /**
       * Calculate the next arrow if it is active or not
       * @memberof link
       */
      function getNextClass() {
        return current() &lt; total() ? '' : 'disabled';
      }

      /**
       * Calculate the previous arrow if it is active or not
       * @memberof link
       */
      function getPrevClass() {
        return current() > 1 ? '' : 'disabled';
      }

      /**
       * Calculate the go to first if it is active or not
       * @memberof link
       */
      function getFirstClass() {
        return current() !== 1 ? '' : 'disabled';
      }

      /**
       * Calculate the go to last if it is active or not
       * @memberof link
       */
      function getLastClass() {
        return current() !== total() ? '' : 'disabled';
      }

      /**
       * Change page to the given index
       * @memberof link
       * @param {int} index - A given page of the array.
       */
      function changePage(index) {
        if (index > total()) {
          vm.invenioSearchArgs.params.page = total();
        } else if ( index &lt; 1) {
          vm.invenioSearchArgs.params.page = 1;
        } else {
          vm.invenioSearchArgs.params.page = index;
        }
      }

      // Pages calculator
      scope.paginationHelper = {
        changePage: changePage,
        current: current,
        getFirstClass: getFirstClass,
        getLastClass: getLastClass,
        getNextClass: getNextClass,
        getPageClass: getPageClass,
        getPrevClass: getPrevClass,
        next: next,
        pages: buildPages,
        previous: previous,
        total: total,
      };
    }

    /**
     * Choose template for pagination
     * @memberof invenioSearchPagination
     * @param {service} element - Element that this direcive is assigned to.
     * @param {service} attrs - Attribute of this element.
     * @example
     *    Minimal template `template.html` usage
     *        &lt;input type="checkbox" value="{{ value }}" /> {{ value }}
     */
    function templateUrl(element, attrs) {
      return attrs.template;
    }

    ////////////

    return {
      restrict: 'AE',
      scope: false,
      require: '^invenioSearch',
      templateUrl: templateUrl,
      link: link,
    };

  }

  ////////////

  // Services

  /**
   * @ngdoc service
   * @name invenioSearchAPI
   * @namespace invenioSearchAPI
   * @param {service} $http - Angular http requests service.
   * @param {service} $q - Angular promise services.
   * @description
   *     Call the search API
   */
  function invenioSearchAPI($http,  $q) {

    /**
     * Make a search request to the API
     * @memberof invenioSearchAPI
     * @param {Object} args - The search request parameters.
     * @returns {service} promise
     */
    function search(args) {

      // Initialize the promise
      var deferred = $q.defer();

      /**
       * Search on success
       * @memberof invenioSearchAPI
       * @param {Object} response - The search API response.
       * @returns {Object} response
       */
      function success(response) {
        deferred.resolve(response);
      }

      /**
       * Search on error
       * @memberof invenioSearchAPI
       * @param {Object} response - The search API error response.
       * @returns {Object} error
       */
      function error(response) {
        deferred.reject(response);
      }

      // Make the request
      $http(args).then(
        success,
        error
      );
      return deferred.promise;
    }
    return {
      search: search
    };
  }

  // Inject the necessary angular services
  invenioSearchAPI.$inject = ['$http', '$q'];

  /**
   * @ngdoc service
   * @name invenioSearchHandler
   * @namespace invenioSearchHandler
   * @param {service} $location - Angular window.location service.
   * @description
   *    window.location API
   */
  function invenioSearchHandler($location) {

    /**
     * Get $location.search() parameters
     * @memberof invenioSearchHandler
     * @returns {Object}
     */
    function get() {
      return $location.search();
    }

    /**
     * Set $location.search() parameters
     * @memberof invenioSearchHandler
     * @param {Object} args - The search request parameters.
     * @returns {Object}
     */
    function set(args) {
      $location.search(args);
    }

    ////////////

    return {
      get: get,
      set: set,
    };
  }

  // Inject the necessary angular services
  invenioSearchHandler.$inject = ['$location'];

  ////////////

  // Configuration

  /**
   * @ngdoc interface
   * @name invenioSearchConfiguration
   * @namespace invenioSearchConfiguration
   * @param {service} $locationProvider - Angular window.location provider.
   * @description
   *     Enable HTML5 mode in urls
   */
  function invenioSearchConfiguration($locationProvider) {
      $locationProvider.html5Mode({
        enabled: true,
        requireBase: false
      });
  }

  // Inject the necessary angular services
  invenioSearchConfiguration.$inject = ['$locationProvider'];

  ////////////

  // Put everything together

  // Setup configuration
  angular.module('invenioSearch.configuration', [])
    .config(invenioSearchConfiguration);

  // Setup services
  angular.module('invenioSearch.services', [])
    .service('invenioSearchHandler', invenioSearchHandler)
    .service('invenioSearchAPI', invenioSearchAPI);

  // Setup controllers
  angular.module('invenioSearch.controllers', [])
    .controller('invenioSearchController', invenioSearchController);

  // Sutup directives
  angular.module('invenioSearch.directives', [])
    .directive('invenioSearch', invenioSearch)
    .directive('invenioSearchBar', invenioSearchBar)
    .directive('invenioSearchError', invenioSearchError)
    .directive('invenioSearchCount', invenioSearchCount)
    .directive('invenioSearchFacets', invenioSearchFacets)
    .directive('invenioSearchResults', invenioSearchResults)
    .directive('invenioSearchLoading', invenioSearchLoading)
    .directive('invenioSearchPagination', invenioSearchPagination)
    .directive('invenioSearchFacetsClick', invenioSearchFacetsClick);

  // Setup everyhting
  angular.module('invenioSearch', [
    'invenioSearch.configuration',
    'invenioSearch.services',
    'invenioSearch.controllers',
    'invenioSearch.directives'
  ]);

  //////////// HAPPY SEARCHING :)

})(angular);
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Thu Jan 14 2016 12:09:55 GMT+0000 (UTC) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
